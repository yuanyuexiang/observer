# 工具检测系统使用说明

## 系统概述

这是一个智能工具检测系统，可以识别工具箱中的工具状态，包括缺失工具和放错位置的工具。系统使用CLIP视觉语言模型和精确的ROI（感兴趣区域）分析技术。

## 功能特性

### 1. 基础检测模式 (detect)
- 使用CLIP模型对整张图片进行工具分类
- 显示最可能的工具类型和置信度
- 生成带有中文标注的检测结果图片

### 2. 工具箱状态检查 (check)
- 基于精确的工具位置标注进行检测
- 识别每个工具的状态：在位✅、缺失❌、不确定🤔
- 计算工具箱完整性百分比
- 生成工具箱状态汇总图片

### 3. 增强检测模式 (enhanced)
- 检测工具是否放在正确位置
- 识别三种状态：正确位置✅、位置错误🔄、检测困难/缺失❌
- 分析每个ROI区域的具体内容
- 生成完整的可视化分析图片，显示所有ROI边界和状态

## 使用方法

### 命令行界面

```bash
# 基础检测
python simple_cli.py detect <图片路径>

# 工具箱状态检查
python simple_cli.py check <图片路径>

# 增强检测（检测工具位置是否正确）
python simple_cli.py enhanced <图片路径>
```

### 示例

```bash
# 检测图片中的工具类型
python simple_cli.py detect test.jpg

# 检查工具箱完整性
python simple_cli.py check test.jpg

# 增强检测，查找放错位置的工具
python simple_cli.py enhanced test3.jpg
```

## 工具类别

系统可以识别以下9种工具：

1. **锤子** (hammer)
2. **一字螺丝刀** (flat_screwdriver)
3. **十字螺丝刀** (cross_screwdriver)
4. **切割工具** (cutter)
5. **卷尺** (tape_measure)
6. **六角扳手套装** (hex_key_set)
7. **螺丝盒** (screw_box)
8. **钳子** (pliers)
9. **扳手** (wrench)

## 输出文件

系统会生成以下类型的输出图片：

- `*_detected.jpg` - 基础检测结果标注
- `*_status.jpg` - 工具箱状态汇总
- `*_enhanced_detected.jpg` - 增强检测可视化
- `temp_roi_*_detected.jpg` - 各个ROI区域的检测结果

## 检测精度

- **基础检测**：适合快速识别图片中的主要工具类型
- **状态检查**：基于精确标注，可以准确判断工具是否在指定位置
- **增强检测**：不仅检测缺失，还能发现放错位置的工具

## 技术特性

### 中文支持
- 所有标注图片都支持中文显示
- 自动检测和加载macOS中文字体
- 解决了"？？？？"乱码问题

### 智能分析
- 使用OpenAI CLIP ViT-B/32模型
- 结合精确的边界框标注数据
- 多阶段检测流程确保准确性

### 可视化输出
- 彩色状态指示器
- 详细的置信度信息
- 直观的ROI边界显示

## 配置文件

系统使用 `instances_default.json` 文件定义工具的精确位置：

```json
{
  "categories": [...],
  "annotations": [
    {
      "id": 1,
      "category_id": 1,
      "bbox": [x, y, width, height]
    }
  ]
}
```

## 故障排除

1. **中文显示问题**：系统会自动查找中文字体，如有问题请检查字体路径
2. **检测精度低**：确保图片清晰，光线充足
3. **ROI错位**：检查 `instances_default.json` 中的边界框坐标

## 应用场景

- 工厂质量控制
- 工具库存管理
- 工作台整理检查
- 安全合规性检查
- 自动化生产线监控

## 系统优势

1. **多模式检测**：从简单分类到精确位置分析
2. **中文本土化**：完整的中文界面和标注
3. **可视化丰富**：多种图片输出格式
4. **高度可配置**：通过JSON文件灵活配置工具位置
5. **技术先进**：基于最新的视觉语言模型

---

**开发信息**：
- 基于OpenAI CLIP模型
- 使用PIL进行图像处理和中文标注
- 支持macOS环境
- Python 3.12+兼容