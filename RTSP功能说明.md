# RTSP流工具检测功能说明

## 📡 功能概述

您的工具检测系统现在已经完全支持RTSP网络摄像头流检测！这意味着您可以：

- 🎥 连接网络摄像头进行实时工具检测
- 📊 每10秒自动检测工具箱状态
- 🔄 自动断线重连功能
- 💻 实时显示视频画面和检测结果

## 🚀 使用方法

### 基本命令
```bash
python3 simple_cli.py video rtsp://192.168.3.213:8080/h264.sdp
```

### 自定义检测间隔
```bash
python3 simple_cli.py video rtsp://192.168.3.213:8080/h264.sdp --interval 5
```

## 🛠️ 功能特性

### 1. 智能源识别
系统会自动识别数据源类型：
- `0, 1, 2...` → 本地摄像头
- `rtsp://...` → 网络RTSP流
- `video.mp4` → 视频文件

### 2. RTSP流处理
- ✅ 自动连接RTSP流
- ✅ 断线自动重连（2秒间隔）
- ✅ 缓冲区优化（降低延迟）
- ✅ 帧率控制（25fps）

### 3. 实时检测
- 🔍 定时检测（默认10秒间隔）
- 🎯 手动触发检测（按'd'键）
- 📊 实时显示完整性状态
- 🚪 优雅退出（按'q'键）

### 4. 专业报告
每次检测都会生成：
- 📋 竖直列表状态报告
- 🟢 绿色标记（工具在位）
- 🔴 红色标记（工具缺失）
- 📊 完整性百分比

## 🔧 技术实现

### VideoToolDetector类
```python
def process_rtsp_stream(self, rtsp_url):
    """处理RTSP视频流"""
    # OpenCV连接管理
    # 参数优化设置
    # 断线重连逻辑
    # 实时检测循环
```

### 连接优化参数
- `CAP_PROP_BUFFERSIZE = 1` (减少延迟)
- `CAP_PROP_FPS = 25` (稳定帧率)
- 2秒重连间隔

## 📋 测试结果

✅ **RTSP连接测试**: 成功连接 rtsp://192.168.3.213:8080/h264.sdp
✅ **视频流读取**: 1920x1080分辨率，0.04秒响应时间
✅ **URL识别**: 正确识别RTSP协议
✅ **系统集成**: 完整集成到simple_cli.py

## 🎯 操作指南

### 启动监控
1. 运行命令：`python3 simple_cli.py video rtsp://192.168.3.213:8080/h264.sdp`
2. 等待"✅ RTSP流连接成功!"消息
3. 观察实时视频窗口

### 控制检测
- **自动检测**: 每10秒自动进行（可自定义间隔）
- **手动检测**: 在视频窗口按'd'键
- **退出程序**: 在视频窗口按'q'键

### 查看结果
- 终端显示实时检测状态
- 窗口标题显示完整性百分比
- 生成专业状态报告图片

## 🚨 故障排除

如果连接失败，检查：
- 🌐 网络连接是否正常
- 📡 RTSP URL是否正确
- 📹 摄像头是否在线
- 🔒 是否需要认证信息
- 🛡️ 防火墙是否阻止连接

## 💡 使用建议

1. **网络稳定**: 确保网络连接稳定，避免频繁断线
2. **检测间隔**: 根据需要调整检测频率（--interval参数）
3. **画面质量**: RTSP流质量影响检测准确性
4. **系统资源**: 长时间运行请注意CPU和内存使用

## 📈 扩展功能

未来可以考虑添加：
- 🔐 RTSP认证支持
- 📱 多路RTSP流同时监控
- 📊 检测数据记录和分析
- 🚨 异常状态报警机制

---

🎉 **恭喜！** 您的工具检测系统现在具备了完整的RTSP网络摄像头支持能力！